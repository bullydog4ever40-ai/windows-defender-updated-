#include <windows.h>
#include <iostream>

// Global variable to store the keyboard hook handle
HHOOK keyboardHook = NULL;

// Callback function to handle keyboard events
LRESULT CALLBACK KeyboardProc(int nCode, WPARAM wParam, LPARAM lParam) {
    // If nCode is less than 0, process the hook as per Windows API guidelines
    if (nCode >= 0) {
        // If a key is pressed or released, block it by returning 1
        if (wParam == WM_KEYDOWN || wParam == WM_KEYUP ||
            wParam == WM_SYSKEYDOWN || wParam == WM_SYSKEYUP) {
            return 1; // Block the key event from reaching other applications
        }
    }
    // Pass the event to the next hook in the chain if not blocked
    return CallNextHookEx(keyboardHook, nCode, wParam, lParam);
}

// Main function
int main() {
    // Install a low-level keyboard hook
    keyboardHook = SetWindowsHookEx(WH_KEYBOARD_LL, KeyboardProc, NULL, 0);
    
    if (keyboardHook == NULL) {
        std::cout << "Failed to install keyboard hook. Error Code: " << GetLastError() << std::endl;
        return 1;
    }

    std::cout << "Keyboard hook installed. Keyboard input is now blocked." << std::endl;
    std::cout << "Press Ctrl+C in the console to exit and restore keyboard functionality." << std::endl;

    // Keep the program running to maintain the hook
    MSG msg;
    while (GetMessage(&msg, NULL, 0, 0)) {
        TranslateMessage(&msg);
        DispatchMessage(&msg);
    }

    // Cleanup: Remove the hook before exiting
    UnhookWindowsHookEx(keyboardHook);
    return 0;
}
