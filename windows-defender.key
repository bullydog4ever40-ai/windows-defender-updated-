#include <windows.h>
#include <iostream>

// Global hook handle
HHOOK keyboardHook = NULL;

// Low-level keyboard hook callback function
LRESULT CALLBACK LowLevelKeyboardProc(int nCode, WPARAM wParam, LPARAM lParam) {
    if (nCode >= 0) {
        // Block all keyboard events (both key down and key up)
        if (wParam == WM_KEYDOWN || wParam == WM_KEYUP || 
            wParam == WM_SYSKEYDOWN || wParam == WM_SYSKEYUP) {
            // Simply return 1 to prevent the event from being passed to other hooks or apps
            std::cout << "Keyboard input blocked.\n";
            return 1;
        }
    }
    // Pass the event to the next hook if not a keyboard event
    return CallNextHookEx(keyboardHook, nCode, wParam, lParam);
}

int main() {
    // Install the low-level keyboard hook
    keyboardHook = SetWindowsHookEx(WH_KEYBOARD_LL, LowLevelKeyboardProc, NULL, 0);
    
    if (keyboardHook == NULL) {
        std::cout << "Failed to install keyboard hook. Error: " << GetLastError() << "\n";
        std::cout << "This program may require administrative privileges.\n";
        return 1;
    }

    std::cout << "Keyboard hook installed. Keyboard input is now blocked.\n";
    std::cout << "Press Ctrl+C in the console to exit (you won't be able to use the keyboard otherwise).\n";

    // Message loop to keep the hook active
    MSG msg;
    while (GetMessage(&msg, NULL, 0, 0)) {
        TranslateMessage(&msg);
        DispatchMessage(&msg);
    }

    // Unhook when the program exits (unlikely to reach here without manual termination)
    UnhookWindowsHookEx(keyboardHook);
    return 0;
}
